(this["webpackJsonpthree-vrm-ai"]=this["webpackJsonpthree-vrm-ai"]||[]).push([[0],{28:function(e,t,n){},29:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var i=n(14),o=n.n(i),a=n(21),r=n.n(a),s=(n(28),n.p+"static/media/logo.6ce24c58.svg"),d=(n(29),n(12)),h=n(10),c=n(3),l=n(4),m=(n(19),n(1)),u=n(2),b=n(0),y=n(23),p=n(8),v=n(22),g=n(11),f=n.n(g),B=n(9),x=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(m.a)(this,n),(i=t.call(this,e)).g=0,i.ga=.01,i.rotations={},i.limits={neck:{axis:"y",x:[-.2,.3],y:[-.2,.2],z:[-.2,.2]},upperChest:{axis:"y",x:[-.2,.1],y:[-.1,.1],z:[-.1,.1]},chest:{axis:"y",x:[-.2,.1],y:[-.1,.1],z:[-.1,.1]},spine:{axis:"y",x:[-.1,.1],y:[-.1,.1],z:[-.1,.1]},leftShoulder:{axis:"x",x:[-0,0],y:[-0,0],z:[-0,0]},rightShoulder:{axis:"x",x:[-0,0],y:[-0,0],z:[-0,0]},leftUpperArm:{axis:"x",x:[-.25,.5],y:[-.75,.25],z:[-.25,.25]},leftLowerArm:{axis:"x",x:[-.5,.5],y:[-.75,0],z:[-0,.75]},rightUpperArm:{axis:"x",x:[-.25,.5],y:[-.25,.75],z:[-.25,.25]},rightLowerArm:{axis:"x",x:[-.5,.5],y:[-0,.75],z:[-.75,0]},leftUpperLeg:{axis:"y",x:[-0,.75],y:[-.25,.25],z:[-.25,.25]},rightUpperLeg:{axis:"y",x:[-0,.75],y:[-.25,.25],z:[-.25,.25]},leftLowerLeg:{axis:"y",x:[-.75,0],y:[-.25,.25],z:[-0,0]},rightLowerLeg:{axis:"y",x:[-.75,0],y:[-.25,.25],z:[-0,0]},leftToes:{axis:"y",x:[-0,0],y:[-0,0],z:[-0,0]},rightToes:{axis:"y",x:[-0,0],y:[-0,0],z:[-0,0]}},i.headBones=[p.b.HumanoidBoneName.Hips,p.b.HumanoidBoneName.Spine,p.b.HumanoidBoneName.Chest,p.b.HumanoidBoneName.UpperChest,p.b.HumanoidBoneName.Neck,p.b.HumanoidBoneName.Head],i.leftEyeBones=[p.b.HumanoidBoneName.Head,p.b.HumanoidBoneName.LeftEye],i.rightEyeBones=[p.b.HumanoidBoneName.Head,p.b.HumanoidBoneName.RightEye],i.leftHandBones=[p.b.HumanoidBoneName.UpperChest,p.b.HumanoidBoneName.LeftShoulder,p.b.HumanoidBoneName.LeftUpperArm,p.b.HumanoidBoneName.LeftLowerArm,p.b.HumanoidBoneName.LeftHand],i.rightHandBones=[p.b.HumanoidBoneName.UpperChest,p.b.HumanoidBoneName.RightShoulder,p.b.HumanoidBoneName.RightUpperArm,p.b.HumanoidBoneName.RightLowerArm,p.b.HumanoidBoneName.RightHand],i.leftFootBones=[p.b.HumanoidBoneName.Hips,p.b.HumanoidBoneName.LeftUpperLeg,p.b.HumanoidBoneName.LeftLowerLeg,p.b.HumanoidBoneName.LeftFoot,p.b.HumanoidBoneName.LeftToes],i.rightFootBones=[p.b.HumanoidBoneName.Hips,p.b.HumanoidBoneName.RightUpperLeg,p.b.HumanoidBoneName.RightLowerLeg,p.b.HumanoidBoneName.RightFoot,p.b.HumanoidBoneName.RightToes],i.body={},i.onCanvasLoaded=function(e){if(e&&!i.currentVrm){i.setState({canvas:e}),i.renderer=new b.Jb({canvas:e,antialias:!0,alpha:!i.props.debug}),i.renderer.setSize(e.clientWidth,e.clientHeight),i.renderer.setPixelRatio(window.devicePixelRatio),document.body.appendChild(i.renderer.domElement),i.camera=new b.bb(30,e.clientWidth/e.clientHeight,.1,500),i.camera.position.set(0,0,10);var t=new v.a(i.camera,i.renderer.domElement);t.screenSpacePanning=!0,t.target.set(0,0,0),t.update(),i.scene=new b.pb;var n=new b.n(16777215);if(n.position.set(1,1,1).normalize(),i.scene.add(n),i.world=new f.a.World,i.world.gravity.set(0,-9.82,0),i.world.gravity.set(0,-.982,0),i.world.broadphase=new f.a.NaiveBroadphase,i.world.solver.iterations=5,i.world.solver.tolerance=.1,i.createGround(i.world),i.loadModel(),i.props.debug){var o=new b.u(10,10);i.scene.add(o);var a=new b.c(5);i.scene.add(a)}i.animate(0)}},i.camera=void 0,i.scene=void 0,i.renderer=void 0,i.currentVrm=void 0,i.clock=new b.l,i.bodies={},i.vx=-.01,i.count=0,i.firstable=!0,i.state={canvas:null},i.animate=i.animate.bind(Object(h.a)(i)),i}return Object(u.a)(n,[{key:"createGround",value:function(e){var t=new f.a.Material("groundMat"),n=new f.a.Plane,i=new f.a.Body({mass:0,material:t});i.addShape(n),i.quaternion.setFromAxisAngle(new f.a.Vec3(1,0,0),-Math.PI/2),i.position.set(0,-1,0),e.addBody(i)}},{key:"loadModel",value:function(){var e=this;(new y.a).load("/three-vrm-ai/vrm/three-vrm-girl.vrm",(function(t){p.a.from(t).then((function(t){console.log(t),e.scene.add(t.scene),e.currentVrm=t,t.humanoid.getBoneNode(p.b.HumanoidBoneName.Hips).rotation.y=Math.PI,t.humanoid.getBoneNode(p.b.HumanoidBoneName.Hips).position.x=0,t.lookAt.target=e.camera,t.lookAt.autoUpdate=!0,e.constructBody(),console.log(e.body),e.createObjectBody()}))}),(function(e){return console.log("Loading model...",e.loaded/e.total*100,"%")}),(function(e){return console.error(e)}))}},{key:"createObjectBody",value:function(){for(var e=0,t=Object.keys(this.body);e<t.length;e++){var n=t[e];this.createObjectBone(this.body[n],0)}}},{key:"createObjectBone",value:function(e,t){if(e)for(var n=0,i=Object.keys(e.children);n<i.length;n++){var o=i[n],a=e.children[o],r=a.name;this.createObject(e,r),this.createObjectBone(a,t+1)}}},{key:"createObject",value:function(e,t){if(!this.bodies[t]){var n=this.getBoneNode(t).position,i=new f.a.Vec3(n.x,n.y,n.z),o=e.name,a=1;o&&(a=n.distanceTo(this.getBoneNode(o).position));var r=new f.a.Body({mass:0,position:i,material:new f.a.Material("groundMat")});r.addShape(new f.a.Sphere(.001)),this.world.addBody(r),r.d=a,this.bodies[t]=r}this.updateObject(t)}},{key:"updateObjectBody",value:function(){for(var e=0,t=Object.keys(this.body);e<t.length;e++){var n=t[e];this.updateObjectBone(this.body[n],0)}}},{key:"updateObjectBone",value:function(e,t){if(e)for(var n=0,i=Object.keys(e.children);n<i.length;n++){var o=i[n],a=e.children[o],r=a.name;this.updateObject(e,r),this.updateObjectBone(a,t+1)}}},{key:"updateObject",value:function(e,t){var n=e.name;if(n){var i=this.getBoneNode(n).position,o=(this.getBoneNode(t).position,this.bodies[t].position),a=this.bodies[t].d,r=new b.Gb(i.x,i.y,i.z),s=new b.Gb(o.x,o.y,o.z);s=(s=(s=s.sub(r)).normalize()).multiplyScalar(a)}}},{key:"moveModel",value:function(e){var t=this.getBoneNode(p.b.HumanoidBoneName.Hips).position;t.x+=e.x,t.y+=e.y,t.z+=e.z,this.getBoneNode(p.b.HumanoidBoneName.Hips).position.set(t.x,t.y,t.z)}},{key:"fallModel",value:function(e){var t=this.getMinY(),n=this.getBoneNode(p.b.HumanoidBoneName.Hips).position;t>0&&(this.g-=this.ga,n.y+=this.g),this.getBoneNode(p.b.HumanoidBoneName.Hips).position.set(n.x,n.y,n.z),t=this.getMinY(),n=this.getBoneNode(p.b.HumanoidBoneName.Hips).position,t<0&&(n.y+=-t,this.g=0),this.getBoneNode(p.b.HumanoidBoneName.Hips).position.set(n.x,n.y,n.z)}},{key:"getMinY",value:function(){for(var e=1,t=0,n=Object.keys(this.limits);t<n.length;t++){var i=n[t],o=new b.Gb;this.getBoneNode(i).getWorldPosition(o),o.y<=0&&o.y<e&&(e=o.y)}return e}},{key:"moveObject",value:function(e,t){var n=this.bodies[e].position;n.x+=t.x,n.y+=t.y,n.z+=t.z,this.bodies[e].position.set(n.x,n.y,n.z)}},{key:"poseDebug",value:function(){var e=1*Math.PI*Math.sin(Math.PI*this.clock.elapsedTime);this.getBoneNode("hips");this.rotateOne("rightUpperArm",e,0,0),this.rotateOne("leftUpperArm",e,0,0),this.rotateOne("leftLowerArm",e,0,0)}},{key:"pose",value:function(){for(var e=0,t=Object.keys(this.bodies);e<t.length;e++){var n=t[e];if(Object.keys(this.limits).includes(n)){if(!Object.keys(this.rotations).includes(n)){var i=this.limits[n],o=this.randomR(i,"x"),a=this.randomR(i,"y"),r=this.randomR(i,"z");this.rotations[n]=[[0,0,0],[0,0,0],[o,a,r]]}var s=this.rotations[n],d=s[0][0],h=s[0][1],c=s[0][2];if(d+=.1*(s[2][0]-d),h+=.1*(s[2][1]-h),c+=.1*(s[2][2]-c),this.rotateOne(n,d,h,c),s[0][0]=d,s[0][1]=h,s[0][2]=c,Math.abs(s[2][0]-d)<.01){i=this.limits[n];var l=this.randomR(i,"x"),m=this.randomR(i,"y"),u=this.randomR(i,"z");this.rotations[n]=[[d,h,c],[0,0,0],[l,m,u]]}}}this.fallModel()}},{key:"randomR",value:function(e,t){var n=this.limitX(e,t,-.5*Math.PI),i=this.limitX(e,t,.5*Math.PI);return Math.random()*(i-n)+n}},{key:"randomX",value:function(e){return.5*Math.PI*(Math.random()-.5)*2}},{key:"rotateOne",value:function(e,t,n,i){if(Object.keys(this.limits).includes(e)){var o=this.limits[e],a=o.axis,r=this.getBoneNode(e),s=new b.hb,d=new b.hb;"x"===a?(d.setFromAxisAngle(new b.Gb(0,1,0),this.limitX(o,"y",n)),s.multiply(d),(d=new b.hb).setFromAxisAngle(new b.Gb(0,0,1),this.limitX(o,"z",i)),s.multiply(d),(d=new b.hb).setFromAxisAngle(new b.Gb(1,0,0),this.limitX(o,"x",t)),s.multiply(d)):(d.setFromAxisAngle(new b.Gb(1,0,0),this.limitX(o,"x",t)),s.multiply(d),(d=new b.hb).setFromAxisAngle(new b.Gb(0,0,1),this.limitX(o,"z",i)),s.multiply(d),(d=new b.hb).setFromAxisAngle(new b.Gb(0,1,0),this.limitX(o,"y",n)),s.multiply(d)),r.setRotationFromQuaternion(s)}}},{key:"limitX",value:function(e,t,n){var i=1*e[t][0]*Math.PI,o=1*e[t][1]*Math.PI;return n<i&&(n=i),n>o&&(n=o),n}},{key:"constructBody",value:function(){for(var e=0,t=Object.keys(this.currentVrm.humanoid.humanBones);e<t.length;e++){var n=t[e],i=this.currentVrm.humanoid.humanBones[n];i&&i.length>0&&this.setBoneInBody(i[0].node.parent,i[0].node)}for(var o=0,a=Object.keys(this.body);o<a.length;o++)for(var r=a[o],s=0,d=Object.keys(this.body);s<d.length;s++){var h=d[s];this.treeBone(this.body[h],r)}for(var c=0,l=Object.keys(this.body);c<l.length;c++){var m=l[c];this.infoBone(this.body[m])}}},{key:"setBoneInBody",value:function(e,t){e.name in this.body||(this.body[e.name]={children:{}}),this.body[e.name].node=e,this.body[e.name].children[t.name]={node:t,children:{}}}},{key:"treeBone",value:function(e,t){if(e)for(var n=e.children,i=0,o=Object.keys(n);i<o.length;i++){var a=o[i];if(a===t)return n[a]=this.body[t],void delete this.body[t];this.treeBone(n[a],t)}}},{key:"infoBone",value:function(e){var t=this;e&&function(){e.node;for(var n=e.children,i=function(){var e=a[o];Object.entries(p.b.HumanoidBoneName).forEach((function(i){var o=Object(d.a)(i,2),a=(o[0],o[1]),r=t.getBoneNode(a);r&&n[e].node.name===r.name&&(n[e].name=a)})),t.infoBone(n[e])},o=0,a=Object.keys(n);o<a.length;o++)i()}()}},{key:"getBoneNode",value:function(e){return this.currentVrm.humanoid.getBoneNode(e)}},{key:"getBlendShapeProxy",value:function(){return this.currentVrm.blendShapeProxy}},{key:"animate",value:function(e){window.requestAnimationFrame(this.animate);var t=this.clock.getDelta();this.currentVrm&&(this.pose(),this.currentVrm.update(t),this.world&&this.world.step(t)),this.renderer.render(this.scene,this.camera)}},{key:"render",value:function(){return Object(B.jsx)("canvas",{id:"canvas",style:{pointerEvents:this.props.debug?"auto":"none",zIndex:"999",position:"fixed",bottom:this.state.canvas?-this.state.canvas.clientHeight/2+"px":"0px",right:"0px",width:"100vw",height:"200vh"},ref:this.onCanvasLoaded})}},{key:"createJoint",value:function(e,t){var n=this.bodies[e.name],i=this.bodies[t.name];n.position,i.position;if(console.log(n,i),n&&i){Math.PI,Math.PI,Math.PI;var o=new f.a.DistanceConstraint(n,i,.1);this.world.addConstraint(o)}}},{key:"doik",value:function(){for(var e=0,t=Object.keys(this.body);e<t.length;e++){var n=t[e];this.targetBone(this.body[n],0)}this.firstable=!1}},{key:"targetBone",value:function(e,t){if(e)for(var n=0,i=Object.keys(e.children);n<i.length;n++){var o=i[n],a=e.children[o],r=a.name;if(this.updateObject(r),t<2&&this.targetBone(a,t+1),this.firstable)for(var s=0,d=Object.keys(a.children);s<d.length;s++){var h=d[s],c=a.children[h];this.createJoint(a,c)}}}}]),n}(o.a.Component);var j=function(){return Object(B.jsxs)("div",{className:"App",children:[Object(B.jsxs)("header",{className:"App-header",children:[Object(B.jsx)("img",{src:s,className:"App-logo",alt:"logo"}),Object(B.jsxs)("p",{children:["Edit ",Object(B.jsx)("code",{children:"src/App.js"})," and save to reload."]}),Object(B.jsx)("a",{className:"App-link",href:"https://reactjs.org",target:"_blank",rel:"noopener noreferrer",children:"Learn React"})]}),Object(B.jsx)(x,{debug:!0})]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,33)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),i(e),o(e),a(e),r(e)}))};r.a.render(Object(B.jsx)(o.a.StrictMode,{children:Object(B.jsx)(j,{})}),document.getElementById("root")),w()}},[[32,1,2]]]);
//# sourceMappingURL=main.3db4a5d5.chunk.js.map